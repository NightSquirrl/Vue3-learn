{"version":3,"file":"reactivity.cjs.js","sources":["../../shared/src/index.ts","../src/baseHandlers.ts","../src/reactive.ts"],"sourcesContent":["// 公共的方法\n\nexport function  isObject(target) {\n    return typeof target === 'object' && target !== null\n}\n\n// 对象合并\nexport const extend = Object.assign;\n","import {isObject,extend} from \"@vue/shared\";\nimport {reactive, readonly} from \"./reactive\";\n\n\nfunction createGetter(isReadonly = false, shallow = false) {\n\n    return function get(target, key, receiver) {\n        const res = Reflect.get(target, key, receiver)\n        if (!isReadonly) {\n            return target\n        }\n        if(shallow) {\n            return res\n        }\n        // key 是一个对象\n        // 面试 懒代理\n        if(isObject(res)) {\n            return isReadonly ? readonly(res) : reactive(res)\n        }\n    }\n}\n\nfunction  createSetter(shallow = false) {\n    return function set(target, key, value, receiver) {\n        // 触发更新\n        return Reflect.set(target, key, value, receiver)\n    }\n\n}\n\n// get\nconst get = createGetter()\nconst shallowGet = createGetter(false, true)\nconst readonlyGet = createGetter(true)\nconst shallowReadonlyGet = createGetter(true, true)\n\n\n// set\nconst set = createSetter()\nconst shallowSet = createSetter(true)\n\nexport const reactiveHandlers = {\n    get,set\n}\nexport const shallowReactiveHandlers = {\n    get: shallowGet,set:shallowSet\n\n\n}\n// 进行合并\nlet readonlyObj = {\n    set:(target,key)=> {\n        console.warn(`set ${target} on key ${key} failed`)\n    }\n}\nexport const readonlyHandlers = extend({\n    get: readonlyGet,\n}, readonlyObj)\n\n\nexport const shallowReadonlyHandlers = extend({\n    get: shallowReadonlyGet,\n}, readonlyObj)\n\n\n//柯里化\n","import {isObject} from \"@vue/shared\";\nimport { reactiveHandlers, shallowReactiveHandlers, readonlyHandlers, shallowReadonlyHandlers } from \"./baseHandlers\";\n\n\n\nexport function reactive(target) {\n    return createReactObj(target, false, reactiveHandlers); // 高阶函数\n}\n\nexport function shallowReactive(target) {\n    return createReactObj(target, false, shallowReactiveHandlers);\n\n}\n\nexport function readonly(target) {\n    return createReactObj(target, true, readonlyHandlers);\n\n}\n\nexport function shallowReadonly(target) {\n    return createReactObj(target, true, shallowReadonlyHandlers);\n\n}\n\n// 核心实现代理\n// 数据结构\nconst reactiveMap = new WeakMap(); // key 必须是对象,自动垃圾回收\nconst readonlyMap = new WeakMap();\n\nfunction createReactObj(target, isReadonly, baseHandlers) {\n    if (!isObject(target)) {\n        // 不是对象\n        return target\n    }\n    // 是对象\n    const proxyMap = isReadonly ? readonlyMap : reactiveMap;\n    // 1. 判断是否已经有代理\n    const existingProxy = proxyMap.get(target);\n    if (existingProxy) {\n        return existingProxy\n    }\n    // 2. 代理\n    const proxy = new Proxy(target, baseHandlers);\n    proxyMap.set(target, proxy)\n    return proxy\n\n}\n\n// 4 个方法 1. 是不是只读 2. 是不是深层\n// 注音核心 proxy  源码采用 柯里化 根据不同的参数\n"],"names":[],"mappings":"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"}